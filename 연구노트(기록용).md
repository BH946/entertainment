



## 02050202 - oracle, api 개발. -> MySQL 사용하기로.

1. oracle에 삽입 -> **perplexity로 테이블 구조 추천!** 검증 후 oracle로 삽입!

   **orange는 1달 무료 끝나서 sql*plus를 사용하겠음.(oracle client 설치할 때 같이 딸려서 설치 된 것 같음. 바로 이 tool 사용 ㄱㄱ)**

   sql developer의 경우 깔려있긴한데 뭐 설정해야할 것 같아서 안함. (참고로 얜 java로 만든거라 jdbc 구현되어 있어서 oracle client가 필요없는 tool임. 공홈에 배포 중)

   ㄴㄴㄴ sql*plus 너무 cli만 있어서 불편. **sql developer 나중에 설치 ㄱㄱ**

   잠깐 MySQL과 Oracle 비교 중..

   중요: MySQL의 Database 단위로 만들어서 접속하는것과 오라클에 하나의 DB에 접속해서 User를 만들어 사용하는것과 유사  
   => 오라클 DB는 각 사용자 별로 테이블, 인덱스, 뷰 등의 **객체가 따로 생성**

   1. MySQL

      - 물리적으로 분리된 여러 데이터베이스 생성 가능

      - DATABASE = SCHEMA 개념 사용

   2. Oracle

      - 하나의 큰 데이터베이스 인스턴스 사용
      - USER = SCHEMA 개념 사용
      - 또한, 너무 메모리 사용이 큼. "대기업"이 선호하지 "중소는 MySQL 사용!"

   **결론: MySQL로 노선 틀겠음**

   **cmd-sqlplus** => 사용X (MySQL 쓸거임)

   ```cmd
   -- db 서버(STR)와 리스너 실행 필수
   sqlplus username/password            -- 일반 접속 (본인: testUser/1234)
   sqlplus / as sysdba                 -- SYSDBA로 접속 (대장)
   sqlplus /nolog                      -- DB 접속없이 SQL*Plus 실행[1][3]
   show user							-- 현재 사용자 확인
   SELECT name FROM v$database;         -- 데이터베이스 이름 확인 (본인: STR)
   SELECT table_name FROM user_tables;  -- 현재 사용자의 테이블 확인
   EXIT 또는 QUIT   -- SQL*Plus 종료[3]
   ```

   **MySQL 워크벤치 쓰기로(돌고래GUI) -> 나중에 본섭 옮길때나 ㄱㄱ H2 DB 먼저 사용하겠음.**

   예상구조는..? => 바로 스프링에서 개발ㄱㄱ

   1. 구한 데이터 json 속성 키값 형태 참고해서 관계 테이블 예상해보겠음

      **타로 카드 테이블** -> 22장 넣으면 됨. 비교적 간단.

      **타로 리딩 테이블 + 타로 카테고리 테이블**

      - 카드 해석할 떄 카테고리의 경우 general, health... 등 여러개인데 나중에 추가 될 수도 있으니 따로 테이블을 추가해서 외래키로 연결하겠다. (어차피 외래키는 인덱스 자동 추가 많이 되니까 성능도 별로 안 느릴거임 ㅇㅇ)
        - 근데, 아마 고정될 듯..? 더 추가 안할 것 같 으 ㄴ느 낌
        - **바로 추가했다. YesNo를 여기다가 넣기로**
      - Daily의 경우 카테고리가 여러개인데(general, health..), 나중에 데이터가 너~무 많아지면 그때 테이블 분할 하던지 하자. 지금은 한번에 이곳에 다 넣기!
        - **테이블 파티셔닝은 카테고리 기준으로 하면 되니까 이거하면 성능은 더 좋아질 것 같다.(DB튜닝)**
        - **참고:** 데이터 규모가 작을 때(100만 행 이하)는 분할 이점 미미
        - **분할 전환 조건**:특정 카테고리(예: YesNo)의 조회 비중이 70% 이상, 데이터 행 수가 100만 행 이상, 디스크 I/O가 병목지점으로 확인될 때
          - 생각해보니 데이터 규모가작아서 절대 분할 안할듯

      **예상 테이블 구조:**

      ```sql
      -- 카드 기본 정보 테이블
      TarotCards
          card_id BIGINT AUTO_INCREMENT PRIMARY KEY,
          name_en VARCHAR(100) NOT NULL,
          name_kr VARCHAR(100) NOT NULL,
          card_number INT NOT NULL UNIQUE,
          image_url VARCHAR(255),
          keyword VARCHAR(500),
          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
          updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
      -- 해석 카테고리 테이블
      ReadingCategories
          category_id BIGINT AUTO_INCREMENT PRIMARY KEY,
          category_name VARCHAR(20) NOT NULL UNIQUE
      -- 카드 해석 내용 테이블
      CardReadings
          reading_id BIGINT AUTO_INCREMENT PRIMARY KEY,
          card_id BIGINT NOT NULL,
          reading_type ENUM('upright', 'reversed') NOT NULL,
          category_id BIGINT NOT NULL,
          description TEXT NOT NULL,
          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
          FOREIGN KEY (card_id) REFERENCES tarotcards(card_id),
          FOREIGN KEY (category_id) REFERENCES readingcategories(category_id)
      ```

      **관계 분석:**

      - TarotCards: ReadingCategories = 직접적인 관계가 없음
      - CardReadings : ReadingCategories = N:1
        - 하나의 카테고리는 여러 개의 해석에 사용될 수 있음
      - TarotCards : CardReadings = 1:N
        - 하나의 카드는 여러 개의 해석을 가질 수 있음

2. 스프링 백엔드 API 개발

   0. 환경설정

      README.md 참고 - 라이브러리는 일단 기본적인 spring-data-jpa,lombok,h2 ㄱㄱ

   1. 테이블 예상 구조도로 엔티티 설계 ㄱ + 데이터 조금만 테스트로 넣기
   2. 레포, 서비스, 컨트롤러도 바로 ㄱ.ㄱ
   3. java 코드로 json파일 2개 다 테이블에 넣기

3. 포스트맨 테스트

<br><br>

## 20250201 - 백엔드 스프링 시작: 타로 ㄱㄱ

타로 부터 ㄱㄱ. 진하게 표시 위주로 바로 ㄱㄱ

흠... 어떤기능?

1. **22장(메이저 아르카나)의 카드 중 1장 선택 -> [참고](https://www.horoscope.com/us/tarot/tarot-daily-love.aspx) 사이트 처럼 화면 구성 ㄱ**
   1. 오늘의 타로-> 숏츠꺼, 건강, 직업, 재물(돈), 사랑 "중에서 1개 랜덤으로 출력 ㄱ"
   2. 카테고리별 타로-> 건강, 직업, 재물(돈), 사랑을 파트별로 ㄱ
   3. Yes or NO-> 정방향Yes, 역방향No + 해당 타로의 의미까지!
2. perplexity ai 활용한 질문+타로카드=리딩 출력
   1. Python에서 할거라 거기서 다시 정리해서 해보자.
   2. 추후엔 최대한 작은 AI모델 가져다가 학습 후 호스팅서버에서 직접 돌리는걸로..ㅇ..ㅇ...ㅇ
3. 회원 로그인 등도 구해둬서 기록하게하자. (이건 추후에.. 타로에선.. 딱히?)

<br>

**"숏츠꺼, 건강, 직업, 재물(돈), 사랑, Yes Or No" 파트별 타로 데이터 셋 구하기**

1. **perplexity ai로 직접 수집하자.. 3개씩 정도 ㄱㄱ. (추후에 더 추가하자. 지금은 3개만..)**

   구하는 프롬프트는 노션 참고 -> 중복 최대한 덜 부탁중.

   웹에는 아래처럼 출력 하자.

   "참고" 사이트 처럼 ㄱ.ㄱ.ㄱ.ㄱ.ㄱ

2. **Yes Or No 는 뭐.. 1개만 ㄱㄱ.** 

   웹에 아래처럼 출력하면 될 듯 ~

   22개 카드를 보여주고 고르게 ㄱ. 정방향, 역방향은 고른 카드에서 랜덤 출력 ㄱ.

   예상 출력 화면은 아래처럼

   YES!
   황제 카드의 키워드는 ?, ?, ?, ? 입니다!
   general...

   다른 카드 고르기(버튼)

<br>

**개발 시작하기.**

1. **데이터 수집 -> perplexity ai 활용 + "계속하기" 자동화 프로그램도 개발**

<br><br>

## 20250201 - 성능+보안 꼭 체크

### 성능 최적화 전략

1. **캐싱 전략**: Redis로 반복 조회 데이터 처리 [4](https://slashdev.io/-guide-to-building-fast-backends-in-spring-boot-in-2024) [39](https://digma.ai/10-spring-boot-performance-best-practices/)

   ```java
   @Cacheable(value = "users", key = "#userId")
   public User getUser(String userId) {
       // DB 조회 로직
   }
   ```

2. **비동기 처리**: @Async + CompletableFuture 활용[4](https://slashdev.io/-guide-to-building-fast-backends-in-spring-boot-in-2024)[39](https://digma.ai/10-spring-boot-performance-best-practices/)

3. **JVM 튜닝**: G1 GC + 힙 메모리 최적화[39](https://digma.ai/10-spring-boot-performance-best-practices/)

4. **쿼리 최적화**: JPA Hint + Batch Size 조정[4](https://slashdev.io/-guide-to-building-fast-backends-in-spring-boot-in-2024)[38](https://www.ijraset.com/research-paper/efficient-backend-development-with-spring-boot)

### 보안 강화 방안

- **HTTPS 강제 적용**: Spring Security 설정[4](https://slashdev.io/-guide-to-building-fast-backends-in-spring-boot-in-2024)[12](https://www.reddit.com/r/java/comments/g6zjdj/what_is_the_benefit_of_using_java_spring_boot_and/)
- **CSRF 보호**: REST API에서는 비활성화[12](https://www.reddit.com/r/java/comments/g6zjdj/what_is_the_benefit_of_using_java_spring_boot_and/)
- **SQL 인젝션 방지**: JPA Parameter Binding 활용[12](https://www.reddit.com/r/java/comments/g6zjdj/what_is_the_benefit_of_using_java_spring_boot_and/)
- **보안 헤더**: Content-Security-Policy 설정[12](https://www.reddit.com/r/java/comments/g6zjdj/what_is_the_benefit_of_using_java_spring_boot_and/)
